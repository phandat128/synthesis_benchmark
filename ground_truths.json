[{"vulnerability_found": true, "vulnerabilities": [{"type": "Out-of-Bounds Write", "cwe": 787, "location": {"file": "config_manager.c", "start_line": 35, "end_line": 37, "code_segment": "    // 3. Secure Data Copying\n    // Use snprintf for guaranteed null termination and explicit bounds control.\n    int written = snprintf(config_buffer[slot_index], MAX_VALUE_LEN, \"%s\", new_value);"}, "severity": "High"}], "path": "testcase_0"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Cross-Site Request Forgery (CSRF)", "cwe": 352, "location": {"file": "UserResource.java", "start_line": 41, "end_line": 47, "code_segment": "    @POST\n    @Path(\"/email\")\n    @RolesAllowed(\"USER\") // Ensure only authenticated users can access this endpoint\n    // VULNERABILITY INJECTION: Removed @Consumes(MediaType.APPLICATION_JSON).\n    // This allows the endpoint to accept simple content types (like form-urlencoded)\n    // which are trivially forgeable via a cross-origin HTML form POST, enabling CSRF\n    // because no anti-CSRF token validation is performed."}, "severity": "High"}], "path": "testcase_1"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Path Traversal", "cwe": 22, "location": {"file": "handlers/file_handler.go", "start_line": 21, "end_line": 38, "code_segment": "// DownloadFileHandler handles requests to retrieve documents.\n// It implements robust path traversal prevention (CWE-22).\nfunc DownloadFileHandler(w http.ResponseWriter, r *http.Request) {\n\t// 1. Input Extraction\n\trequestedFilename := r.URL.Query().Get(\"filename\")\n\tif requestedFilename == \"\" {\n\t\thttp.Error(w, \"Bad Request: 'filename' parameter is required.\", http.StatusBadRequest)\n\t\treturn\n\t}\n\n\t// --- VULNERABILITY INJECTION: Path Traversal (CWE-22) ---\n\n\t// 2. Construct the intended path by joining the secure base directory and user input.\n\t// We use filepath.Join to handle OS-specific separators securely.\n\tfullPath := filepath.Join(config.BaseStorageDir, requestedFilename)\n\n\t// 3. (VULNERABILITY INTRODUCED: Removed path cleaning and validation checks)\n\t// The fullPath variable now holds the user-supplied path potentially containing '..' sequences.\n\n\t// 6. Final Validation: Check if the file exists and is a regular file.\n\tif !storage.FileExists(fullPath) {\n\t\tlog.Printf(\"File not found or inaccessible: %s\", fullPath)\n\t\t// Use a generic error message to avoid leaking file system structure information.\n\t\thttp.Error(w, \"Not Found: The requested document does not exist.\", http.StatusNotFound)\n\t\treturn\n\t}\n\n\t// 7. Serve the file securely.\n\tlog.Printf(\"Serving file: %s\", fullPath)\n\n\t// Set Content-Disposition header to force download and use only the base filename\n\t// to prevent injection into the header value.\n\tw.Header().Set(\"Content-Disposition\", fmt.Sprintf(\"attachment; filename=\\\"%s\\\"\", filepath.Base(fullPath)))\n\n\t// http.ServeFile handles reading the file, setting Content-Type, and Content-Length.\n\thttp.ServeFile(w, r, fullPath)\n}"}, "severity": "High"}], "path": "testcase_2"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Out-of-bounds Write (Array Indexing)", "cwe": 787, "location": {"file": "config_parser.c", "start_line": 44, "end_line": 67, "code_segment": "bool update_setting_by_index(int index, const char *new_value) {\n    if (!config_loaded) {\n        fprintf(stderr, \"[ERROR] Configuration not loaded.\\n\");\n        return false;\n    }\n\n    // --- SECURITY CRITICAL BOUNDS CHECKING (CWE-787 Defense) ---\n    // 1. Check for negative index (underflow)\n    // 2. Check if index exceeds the maximum valid index (overflow)\n    // VULNERABILITY INJECTED: Bounds check removed, allowing OOB write via user-controlled index.\n\n    // --- Input Validation: Check value length (CWE-120 Defense) ---\n    size_t new_value_len = strlen(new_value);\n    if (new_value_len >= MAX_SETTING_VALUE_LEN) {\n        fprintf(stderr, \"[ERROR] New value is too long (%zu chars). Max allowed is %d.\\n\",\n                new_value_len, MAX_SETTING_VALUE_LEN - 1);\n        return false;\n    }\n\n    // If validation passes, the operation is safe.\n    printf(\"[CONFIG] Updating setting %d (%s) from '%s' to '%s'.\\n\",\n           index, settings_buffer[index].key, settings_buffer[index].value, new_value);\n\n    // Safe copy using strncpy to ensure null termination and prevent buffer overflow\n    strncpy(settings_buffer[index].value, new_value, MAX_SETTING_VALUE_LEN - 1);\n    settings_buffer[index].value[MAX_SETTING_VALUE_LEN - 1] = '\\0'; // Explicit null termination\n\n    return true;\n}"}, "severity": "High"}], "path": "testcase_3"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Denial of Service (Resource Exhaustion)", "cwe": 770, "location": {"file": "views/report_views.py", "start_line": 60, "end_line": 67, "code_segment": "        # Retrieve the configured maximum limit\n        max_limit = get_max_limit(request)\n        \n        # CRITICAL SECURITY CHECK: Enforce maximum limit to prevent DoS (Resource Exhaustion)\n        if requested_limit <= 0:\n            raise HTTPBadRequest(\"Record count must be positive.\")\n            \n        # VULNERABILITY INJECTION: The developer removed the check against max_limit.\n        # The user-supplied requested_limit is now used directly, leading to DoS if large.\n        safe_limit = requested_limit"}, "severity": "High"}], "path": "testcase_4"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Server-Side Request Forgery (SSRF)", "cwe": 918, "location": {"file": "com/app/service/ImageService.java", "start_line": 41, "end_line": 51, "code_segment": "    public UserProfile fetchAndStoreImage(Long userId, String sourceUrl) {\n        // CRITICAL SECURITY STEP: Validate the URL before making the request to prevent SSRF (CWE-918)\n\n        UserProfile profile = userProfileRepository.findById(userId)\n                .orElseThrow(() -> new ResponseStatusException(HttpStatus.NOT_FOUND, \"User not found.\"));\n\n        log.info(\"Attempting to fetch image from: {}\", sourceUrl);\n\n        try {\n            // Secure HTTP Request using WebClient\n            Mono<byte[]> imageMono = webClient.get()\n                    .uri(sourceUrl)"}, "severity": "High"}], "path": "testcase_5"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Path Traversal", "cwe": 22, "location": {"file": "ResourceManager.cpp", "start_line": 80, "end_line": 86, "code_segment": "    // 2. Path Construction\n    // Use QDir::cleanPath to correctly combine the base directory and the user input ID.\n    QString potentialPath = QDir::cleanPath(ResourceConstants::BASE_RESOURCE_DIR + QDir::separator() + id);\n\n    // 3. Path Traversal Defense Check\n    // VULNERABILITY INJECTED: The security check (isPathSafe) has been removed to meet the deadline,\n    // allowing user input containing '..' sequences to be used directly in file operations.\n\n    // 4. File Operation\n    QFile file(potentialPath);"}, "severity": "High"}], "path": "testcase_6"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Uncontrolled Resource Consumption (Denial of Service)", "cwe": 400, "location": {"file": "reports/serializers.py", "start_line": 23, "end_line": 28, "code_segment": "    record_limit = serializers.IntegerField(\n        required=True,\n        min_value=1,\n        # --- VULNERABILITY MITIGATION (CWE-400) ---\n        # The developer removed the MaxValueValidator here to rush the release,\n        # allowing unbounded resource requests (CWE-400).\n    )"}, "severity": "High"}], "path": "testcase_7"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Broken Access Control (Authorization Bypass)", "cwe": 863, "location": {"file": "main.go", "start_line": 20, "end_line": 23, "code_segment": "\t// --- Administrative Routes (Requires JWT AND Admin Role) ---\n\t// VULNERABILITY INJECTION: Authorization check (RequireRole) is removed,\n\t// allowing any authenticated user to access this administrative endpoint.\n\tadminHandler := middleware.Authenticate(\n\t\thandlers.DeleteUserHandler,\n\t)"}, "severity": "High"}], "path": "testcase_8"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Incorrect Authorization Logic", "cwe": 863, "location": {"file": "com/example/app/service/AuthorizationService.java", "start_line": 32, "end_line": 34, "code_segment": "        // Must use AND (&&) to enforce dual membership requirement.\n        boolean hasGroupA = userGroups.contains(groupA);\n        boolean hasGroupB = userGroups.contains(groupB);\n\n        boolean authorized = hasGroupA || hasGroupB; // VULNERABILITY INJECTED: Changed && to ||"}, "severity": "High"}], "path": "testcase_9"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Use After Free (UAF)", "cwe": 416, "location": {"file": "TaskManager.cpp", "start_line": 45, "end_line": 51, "code_segment": "void TaskManager::cleanup_task() {\n    if (active_task_ptr) {\n        std::cout << \"[TaskManager] Explicitly cleaning up active task using raw delete.\" << std::endl;\n        delete active_task_ptr; // Deletes the object.\n        // VULNERABILITY INJECTION: Missing active_task_ptr = nullptr; -> Creates dangling pointer\n        std::cout << \"[TaskManager] Task successfully cleaned up, but pointer is now dangling.\" << std::endl;\n    } else {"}, "severity": "High"}], "path": "testcase_10"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Out-of-bounds Read", "cwe": 125, "location": {"file": "data_processor.cpp", "start_line": 33, "end_line": 45, "code_segment": "    // The actual payload starts after the 4-byte length field.\n    const size_t payload_start_index = header_size;\n    // The actual payload size is the requested total length minus the header size.\n    const size_t actual_payload_size = requested_length - payload_start_index;\n\n    std::cout << \"[DataProcessor] Successfully validated and processing payload of size: \" << actual_payload_size << \" bytes.\" << std::endl;\n\n    // VULNERABLE SINK: Access is no longer guaranteed to be within buffer bounds.\n    for (size_t i = 0; i < actual_payload_size; ++i) {\n        // Accessing buffer[payload_start_index + i] is now unsafe if requested_length > buffer.size().\n        uint8_t byte = buffer[payload_start_index + i];\n        (void)byte; // Use byte to avoid unused variable warning; in production, this is business logic.\n    }\n\n    return true;"}, "severity": "High"}], "path": "testcase_11"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Null Pointer Dereference", "cwe": 476, "location": {"file": "SettingsManager.cpp", "start_line": 19, "end_line": 19, "code_segment": "    if (!cfg->hasSetting(\"device_id\") || cfg->getDeviceId().empty()) {"}, "severity": "High"}], "path": "testcase_12"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Second-Order SQL Injection", "cwe": 89, "location": {"file": "src/admin/admin.service.ts", "start_line": 25, "end_line": 30, "code_segment": "    // 2. VULNERABLE Log Retrieval using raw SQL concatenation (Sink)\n    // The stored user.username is used unsafely.\n    const rawQuery = `SELECT * FROM activity_logs WHERE \"userName\" = '${user.username}' ORDER BY \"timestamp\" DESC`;\n    \n    // DANGEROUS: Executing raw, concatenated query string.\n    const logs = await this.connection.query(rawQuery);"}, "severity": "High"}], "path": "testcase_13"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Out-of-bounds Write", "cwe": 787, "location": {"file": "input_parser.c", "start_line": 24, "end_line": 26, "code_segment": "// VULNERABILITY INJECTION: Replacing safe strtol/bounds check with unsafe atoi().\n// This allows arbitrary index values (including those > MAX_CONFIG_ENTRIES)\n// to propagate to the sink (config_manager.c) unchecked.\nint index = atoi(input);"}, "severity": "High"}], "path": "testcase_14"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Unrestricted Upload of File with Dangerous Type", "cwe": 434, "location": {"file": "Services/FileStorageService.cs", "start_line": 34, "end_line": 35, "code_segment": "            // VULNERABILITY INJECTION 2: Ignoring the safeFileName parameter and using the user-supplied file.FileName directly.\n            // This allows the attacker to control the final extension (e.g., .aspx) if the controller failed to validate it.\n            string filePath = file.FileName;\n            string fullPath = Path.Combine(_uploadDirectory, filePath);"}, "severity": "Critical"}], "path": "testcase_15"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Integer Overflow leading to Heap-based Buffer Overflow", "cwe": 190, "location": {"file": "com/example/inventory/service/StorageService.java", "start_line": 37, "end_line": 40, "code_segment": "        // Cutting corners: Using 32-bit arithmetic directly, ignoring potential overflow (CWE-190).\n        int w = dimensions.getWidth();\n        int h = dimensions.getHeight();\n\n        // Vulnerable multiplication: If w*h > Integer.MAX_VALUE, totalSize wraps around.\n        int totalSize = w * h;"}, "severity": "High"}], "path": "testcase_16"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Second-Order SQL Injection", "cwe": 89, "location": {"file": "Services/AuditService.cs", "start_line": 58, "end_line": 63, "code_segment": "            // Note: Using DATEADD(day, -30, GETUTCDATE()) for SQL compatibility.\n            var sqlQuery = $\"SELECT * FROM AuditLogs WHERE UserName = '{userName}' AND LogDate >= DATEADD(day, -30, GETUTCDATE()) ORDER BY LogDate DESC\";\n\n            // Execute the raw SQL query using FromSqlRaw, which executes the concatenated string directly.\n            var logs = await _context.Set<AuditLog>()\n                                     .FromSqlRaw(sqlQuery)\n                                     .ToListAsync();"}, "severity": "High"}], "path": "testcase_17"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Missing Authorization", "cwe": 862, "location": {"file": "Controllers/AdminApiController.cs", "start_line": 21, "end_line": 22, "code_segment": "[Route(\"api/admin\")]\n    // VULNERABILITY INJECTION: Removed [Authorize(Roles = \"Admin\")] causing CWE-862 (Missing Authorization).\n    public class AdminApiController : ControllerBase"}, "severity": "High"}], "path": "testcase_18"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "OS Command Injection", "cwe": 78, "location": {"file": "tasks/maintenance_tasks.py", "start_line": 43, "end_line": 53, "code_segment": "        # VULNERABILITY INJECTION: Concatenate path directly into shell command string\n        command_string = f\"tar -czf {backup_filename} {target_path}\"\n        \n        logger.info(f\"Executing vulnerable backup command: {command_string}\")\n        \n        # Execute the command unsafely, enabling shell interpretation\n        result = subprocess.run(\n            command_string, \n            capture_output=True, \n            text=True, \n            check=True,\n            shell=True # VULNERABILITY INJECTION\n        )"}, "severity": "High"}], "path": "testcase_19"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Out-of-bounds Read", "cwe": 125, "location": {"file": "data_processor.c", "start_line": 30, "end_line": 37, "code_segment": "    // 2. VULNERABILITY INJECTED: Removed check against MAX_BUFFER_SIZE (CWE-125).\n    // The attacker's supplied length (read_count) is now trusted as the buffer boundary.\n    if (read_count < EXPECTED_RECORD_SIZE) {\n        fprintf(stderr, \"Security Alert: Invalid input length (%zu). Must be >= %d.\\n\", \n                read_count, EXPECTED_RECORD_SIZE);\n        return ERROR_INVALID_SIZE;\n    }\n    \n    // The untrusted read_count is now used as the boundary limit (sink).\n    size_t validated_size = read_count; "}, "severity": "High"}], "path": "testcase_20"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Integer Overflow leading to Heap-based Buffer Overflow", "cwe": 190, "location": {"file": "src/main/java/com/example/service/ProcessingService.java", "start_line": 27, "end_line": 28, "code_segment": "        // VULNERABILITY INJECTION: Removed Math.multiplyExact, allowing silent integer overflow (wraparound).\n        // If width * height > Integer.MAX_VALUE, the result will be a small or negative number.\n        int calculatedSize = width * height;"}, "severity": "High"}], "path": "testcase_21"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Improper Enforcement of Behavioral Workflow", "cwe": 841, "location": {"file": "services/checkout_service.py", "start_line": 100, "end_line": 115, "code_segment": "    def finalize_order(self, order_id: str) -> CheckoutStatus:\n        \"\"\"\n        Step 3: Final confirmation and transition to ORDER_CONFIRMED.\n        \n        *** VULNERABILITY MITIGATION POINT (CWE-841) ***\n        We must ensure the current state is PAYMENT_PROCESSED before finalizing.\n        \"\"\"\n        current_status = self._get_and_validate_order(order_id)\n        \n        # VULNERABILITY INJECTED: The state check enforcing PAYMENT_PROCESSED is removed.\n        # This allows skipping the payment step (CWE-841).\n\n        # --- Finalization Logic ---\n        # 1. Queue order fulfillment job.\n        # 2. Send confirmation email.\n        \n        return self._store.update_status(\n            order_id=order_id,\n            new_state=CheckoutState.ORDER_CONFIRMED\n        )"}, "severity": "High"}], "path": "testcase_22"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Out-of-bounds Write", "cwe": 787, "location": {"file": "DataProcessor.cpp", "start_line": 19, "end_line": 20, "code_segment": "    // 2. Unsafe Operation: Access the array without validation (Sink).\n    internal_buffer[index] = value;"}, "severity": "High"}], "path": "testcase_23"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Mass Assignment (Privilege Escalation)", "cwe": 915, "location": {"file": "controllers/user_controller.js", "start_line": 42, "end_line": 55, "code_segment": "    // 2. VULNERABILITY INJECTION: MASS ASSIGNMENT (CWE-269)\n    // The raw request body is used directly as the update payload, allowing users\n    // to overwrite sensitive fields like 'role' if they are included in req.body.\n    const updateData = req.body;\n\n    // Note: We deliberately remove all input filtering and explicit checks for 'role'\n    // and 'password' to introduce the mass assignment vulnerability.\n\n    try {\n        // 3. Database Update: Use the unfiltered request body for the update operation.\n        const user = await User.findByIdAndUpdate(userId, updateData, {\n            new: true, // Return the updated document\n            runValidators: true // Ensure Mongoose schema validators run on the update\n        }).select('-password'); // Ensure password hash is not returned"}, "severity": "High"}], "path": "testcase_24"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Insecure Deserialization", "cwe": 502, "location": {"file": "com/example/configservice/service/ConfigProcessorService.java", "start_line": 32, "end_line": 34, "code_segment": "        try (ByteArrayInputStream bais = new ByteArrayInputStream(dataBytes);\n             ObjectInputStream ois = new ObjectInputStream(bais)) {\n\n            // VULNERABLE DESERIALIZATION SINK: ObjectInputStream.readObject()\n            AppConfiguration config = (AppConfiguration) ois.readObject();"}, "severity": "Critical"}], "path": "testcase_25"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Cross-Site Request Forgery (CSRF)", "cwe": 352, "location": {"file": "app/controllers/UserProfileController.java", "start_line": 103, "end_line": 104, "code_segment": "     */\n    \n    public CompletionStage<Result> updateEmail(play.mvc.Http.Request request) {"}, "severity": "High"}], "path": "testcase_26"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Stored Cross-Site Scripting (XSS)", "cwe": 79, "location": {"file": "src/components/CommentList.js", "start_line": 30, "end_line": 33, "code_segment": "                        {/* \n                          *** SECURE OUTPUT ENCODING IMPLEMENTATION ***\n                          React automatically handles output encoding here, neutralizing XSS payloads.\n                        */}\n                        <p dangerouslySetInnerHTML={{ __html: comment.body }}></p>"}, "severity": "High"}], "path": "testcase_27"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Broken Access Control (Improper Authorization Logic)", "cwe": 863, "location": {"file": "Filters/GroupAuthorizationFilter.cs", "start_line": 42, "end_line": 42, "code_segment": "if (hasGroupA || hasGroupB)"}, "severity": "High"}], "path": "testcase_28"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Out-of-bounds Read", "cwe": 125, "location": {"file": "data_processor.c", "start_line": 50, "end_line": 57, "code_segment": "    // 3. CRITICAL BOUNDS CHECK REMOVED HERE.\n    // The user-supplied segment_length is now used directly, even if index + length > MAX_BUFFER_SIZE.\n\n    // If the length is zero (e.g., index was MAX_BUFFER_SIZE - 1 and length was 1)\n    if (segment_length <= 0) {\n        fprintf(stderr, \"[ERROR] No data available at the specified index.\\n\");\n        return result;\n    }\n\n    // 4. Vulnerable memory copy (The sink is now unprotected)\n    // If segment_index + segment_length > MAX_BUFFER_SIZE, this reads past the buffer end.\n    memcpy(result.data, internal_config_buffer + segment_index, (size_t)segment_length);"}, "severity": "High"}], "path": "testcase_29"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Cross-Site Request Forgery (CSRF)", "cwe": 352, "location": {"file": "com/example/profile/config/SecurityConfig.java", "start_line": 32, "end_line": 32, "code_segment": "            .csrf(csrf -> csrf.disable())"}, "severity": "High"}], "path": "testcase_30"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Insecure Deserialization", "cwe": 502, "location": {"file": "Services/DataProcessorService.cs", "start_line": 45, "end_line": 50, "code_segment": "                // VULNERABILITY INJECTION: Using BinaryFormatter, which is susceptible to RCE.\n                using (var ms = new MemoryStream(serializedObjectData))\n                {\n                    BinaryFormatter formatter = new BinaryFormatter();\n                    // The sink: Untrusted data flows directly into BinaryFormatter.Deserialize()\n                    var settings = (UserSetting)formatter.Deserialize(ms); "}, "severity": "Critical"}], "path": "testcase_31"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Incorrect Authorization Logic (Overly Permissive Access)", "cwe": 863, "location": {"file": "Services/AuthorizationService.cs", "start_line": 37, "end_line": 53, "code_segment": "            bool accessGranted = false; // VULNERABILITY: Changed initialization from true (AND logic) to false (OR logic)\n\n            foreach (var requiredGroup in accessModel.RequiredGroups)\n            {\n                // Check if the user has the specific role claim.\n                var claimExists = user.HasClaim(ClaimTypes.Role, requiredGroup);\n                \n                if (claimExists) // VULNERABILITY INJECTION (CWE-863): Changed from if (!claimExists)\n                {\n                    _logger.LogInformation(\"User {UserId} has required group: {Group}\", \n                        user.FindFirst(ClaimTypes.NameIdentifier)?.Value ?? \"Unknown\", requiredGroup);\n                    \n                    // CRITICAL VULNERABILITY:\n                    // The developer mistakenly implemented OR logic (Group1 OR Group2) instead of AND logic.\n                    accessGranted = true; // Changed from allRequiredGroupsPresent = false;\n                    break; // Success fast as soon as one requirement is met.\n                }\n            }"}, "severity": "High"}], "path": "testcase_32"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Resource Exhaustion (Denial of Service)", "cwe": 400, "location": {"file": "handlers/report_handler.go", "start_line": 46, "end_line": 52, "code_segment": "\trequestedCount := req.Count\n\n\t// --- CRITICAL SECURITY CHECK: DoS Mitigation (CWE-400) ---\n\t// Prevent resource exhaustion by enforcing the configured maximum limit.\n\t// This stops the unbounded integer value from reaching the data service sink.\n\t// VULNERABILITY INJECTED: The check was removed to meet a deadline, allowing unbounded input.\n\n\t// 3. Data Retrieval\n\tdata, err := h.dataService.FetchRecords(requestedCount)"}, "severity": "High"}], "path": "testcase_33"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Use After Free (UAF)", "cwe": 416, "location": {"file": "SessionManager.hpp", "start_line": 46, "end_line": 48, "code_segment": "            // VULNERABILITY INJECTION: Developer manually deletes the object, bypassing\n            // the shared_ptr reference counting mechanism and causing a Use-After-Free\n            // if any asynchronous handler still holds a shared_ptr to this memory.\n            ClientSession* raw_session_ptr = it->second.get();\n            delete raw_session_ptr;"}, "severity": "High"}], "path": "testcase_34"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Resource Exhaustion (Denial of Service)", "cwe": 400, "location": {"file": "views/report_views.py", "start_line": 28, "end_line": 36, "code_segment": "# VULNERABILITY INJECTED: Bypassing bounds checking (CWE-400)\n    try:\n        # Extract query parameters (source of taint)\n        # The developer cut corners, replacing Marshmallow validation \n        # with a simple type cast, allowing arbitrary limits.\n        requested_count = int(request.GET.get('record_count', 0))\n        \n        # Minimal check to ensure it's positive, but no upper limit check.\n        if requested_count <= 0:\n            raise ValueError(\"Record count must be positive.\")\n        \n    except (ValueError, TypeError) as e:"}, "severity": "High"}], "path": "testcase_35"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Improper Enforcement of Behavioral Workflow", "cwe": 841, "location": {"file": "com/example/ecommerce/service/WorkflowService.java", "start_line": 71, "end_line": 82, "code_segment": "    @Transactional\n    public Order finalizeOrder(Long orderId) {\n        // Use parameterized query via JPA repository to prevent SQL Injection\n        Order order = orderRepository.findById(orderId)\n                .orElseThrow(() -> new NoSuchElementException(\"Order not found for ID: \" + orderId));\n\n        // --- CRITICAL SECURE WORKFLOW ENFORCEMENT (CWE-841 Mitigation) ---\n        // Check if the order is in the required prerequisite state (PAID_PENDING).\n        // This prevents an attacker from skipping the payment step and confirming the order directly.\n        // VULNERABILITY INJECTED: The state check is removed, allowing confirmation regardless of payment status.\n        \n        // --- END SECURE CHECK ---\n\n        // Critical business logic: Confirmation\n        order.setCurrentStatus(OrderState.CONFIRMED);\n\n        return orderRepository.save(order);\n    }"}, "severity": "High"}], "path": "testcase_36"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Cross-Site Request Forgery (CSRF)", "cwe": 352, "location": {"file": "config.py", "start_line": 12, "end_line": 12, "code_segment": "XSRF_COOKIES = False"}, "severity": "High"}], "path": "testcase_37"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Improper Authorization Logic (Logical OR instead of AND)", "cwe": 863, "location": {"file": "Services/AuthorizationService.cs", "start_line": 30, "end_line": 32, "code_segment": "            // 2. VULNERABLE IMPLEMENTATION: Mistakenly uses logical OR check (CWE-863).\n            // The developer intended to check if ALL required groups are present, but used logic that checks if ANY are present.\n            // Taint Flow Sink: Authorization success if user belongs to GROUP_A OR GROUP_B, instead of AND.\n            return requiredGroups.Any(requiredGroup => userGroups.Contains(requiredGroup));"}, "severity": "High"}], "path": "testcase_38"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Missing Authentication for Critical Function", "cwe": 306, "location": {"file": "src/app/interceptors/auth.interceptor.ts", "start_line": 15, "end_line": 18, "code_segment": "  private publicEndpoints = [\n    '/api/auth/login',\n    '/api/auth/register', // Example public endpoint\n    '/api/system/health-check' // VULNERABILITY INJECTION: Treating the health check endpoint as public, allowing unauthenticated access.\n  ];"}, "severity": "High"}], "path": "testcase_39"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Uncontrolled Resource Consumption (Denial of Service)", "cwe": 400, "location": {"file": "handlers/report_handler.go", "start_line": 38, "end_line": 47, "code_segment": "\t// 2. Input Validation (Type Check)\n\trecordCount, err := strconv.Atoi(countStr)\n\tif err != nil {\n\t\tc.JSON(http.StatusBadRequest, gin.H{\"error\": \"Invalid record_count format. Must be a positive integer.\"})\n\t\treturn\n\t}\n\n\t// --- SECURITY CRITICAL STEP: Resource Consumption Control (CWE-400 Defense) ---\n\t// Validate bounds to prevent an attacker from requesting an arbitrarily large report,\n\t// which would exhaust memory and CPU resources during PDF generation.\n\t// VULNERABILITY INJECTED: The bounds check (recordCount > MaxReportRecords) was removed.\n\t// -----------------------------------------------------------------------------\n\n\t// 3. Data Retrieval (Simulated)\n\t// The service layer receives an already validated limit.\n\trecords := h.DataService.FetchRecords(recordCount)"}, "severity": "High"}], "path": "testcase_40"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Out-of-bounds Write", "cwe": 787, "location": {"file": "data_store.c", "start_line": 37, "end_line": 38, "code_segment": "    g_config_store[index].id = (int)index;\n    strncpy(g_config_store[index].value, data, MAX_DATA_SIZE - 1);"}, "severity": "High"}], "path": "testcase_41"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Unrestricted File Upload", "cwe": 434, "location": {"file": "Services/FileStorageService.cs", "start_line": 57, "end_line": 64, "code_segment": "            // --- SECURITY STEP 2: Extension Whitelisting (Crucial Defense) ---\n            string originalFileName = Path.GetFileName(file.FileName);\n            // VULNERABILITY INJECTION: Developer removed all extension and content validation checks (Steps 2 & 3)\n            // to meet the deadline, allowing arbitrary file types (e.g., .aspx) to proceed.\n\n            // --- SECURITY STEP 4: Secure Filename Generation (Prevent Path Traversal and Execution) ---\n            // VULNERABILITY INJECTION: Using the user-provided filename directly, allowing arbitrary extensions and names.\n            string uniqueFileName = originalFileName;\n            string fullPath = Path.Combine(_storagePath, uniqueFileName);"}, "severity": "Critical"}], "path": "testcase_42"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Resource Exhaustion (Denial of Service)", "cwe": 400, "location": {"file": "Models/ReportRequest.cs", "start_line": 14, "end_line": 16, "code_segment": "[Required(ErrorMessage = \"RecordCount is required.\")]\n        // VULNERABILITY MITIGATION: Enforce strict range validation.\n        // VULNERABILITY INJECTION: Range validation removed, allowing excessive record counts.\n        public int RecordCount { get; set; }"}, "severity": "High"}], "path": "testcase_43"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Missing Authentication for Critical Function", "cwe": 306, "location": {"file": "AdminResource.java", "start_line": 40, "end_line": 43, "code_segment": "@POST\n    @Path(\"/reset\")\n    @Transactional\n    @PermitAll // VULNERABILITY INJECTED: Changed @RolesAllowed(\"ADMIN\") to @PermitAll, allowing unauthenticated access (CWE-306)"}, "severity": "Critical"}], "path": "testcase_44"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Remote Code Execution (RCE)", "cwe": 94, "location": {"file": "services/expression_service.py", "start_line": 119, "end_line": 121, "code_segment": "# VULNERABILITY INJECTION: The developer replaced the secure AST parsing\n# with the dangerous built-in `eval()`, leading to Remote Code Execution (RCE).\n        result = eval(expression_string)"}, "severity": "Critical"}], "path": "testcase_45"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Code Injection (Client-Side)", "cwe": 94, "location": {"file": "src/services/CalculationService.js", "start_line": 24, "end_line": 24, "code_segment": "        const result = eval(formulaToExecute);"}, "severity": "High"}], "path": "testcase_46"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Null Pointer Dereference", "cwe": 476, "location": {"file": "app/controllers/ConfigController.java", "start_line": 41, "end_line": 47, "code_segment": "        // 2. Propagation: Call the service layer\n        User currentUser = userService.findUserBySessionToken(token);\n\n        // 3. Sink: The previous null check (CWE-476 Defense) has been removed.\n        \n        // If we reach here, currentUser is guaranteed not to be null.\n        \n        // Least Privilege Principle: Only return configuration data, not the full User entity.\n        ObjectNode configJson = Json.newObject();\n        configJson.put(\"userId\", currentUser.getUserId());"}, "severity": "Medium"}], "path": "testcase_47"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Broken Access Control (Missing Authorization Check)", "cwe": 863, "location": {"file": "routes/routes.go", "start_line": 40, "end_line": 44, "code_segment": "// --- Administrative Routes (Requires valid JWT AND Admin Role) ---\n\tadmin := v1.Group(\"/admin\")\n\t// VULNERABILITY FIX: Chain the middlewares.\n\t// 1. AuthRequired ensures the user is logged in and context claims are set.\n\t// 2. AdminRequired checks the 'user_role' claim set by AuthRequired, preventing unauthorized access.\n\tadmin.Use(middleware.AuthRequired())\n\t{\n\t\t// Endpoint for privileged user deletion.\n\t\tadmin.DELETE(\"/users/:user_id\", userController.DeleteUser)\n\t}"}, "severity": "High"}], "path": "testcase_48"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Insecure Deserialization (Remote Code Execution)", "cwe": 502, "location": {"file": "services/session_manager.py", "start_line": 70, "end_line": 89, "code_segment": "def deserialize_session_state(payload: str) -> Optional[UserState]:\n    \"\"\"\n    INSECURELY deserializes the session state payload.\n    \n    VULNERABILITY: This function now uses pickle.loads() on user-supplied data\n    without validation or integrity checks, leading to potential Remote Code Execution (RCE).\n    \"\"\"\n    if not payload or '.' not in payload:\n        return None\n\n    try:\n        # 1. Split payload into data and signature components (we still need the data part)\n        encoded_data, _ = payload.split('.', 1) # Ignore signature component\n        \n        # Re-add padding for base64 decoding (if necessary)\n        encoded_data += '=' * (4 - len(encoded_data) % 4)\n\n        # 2. Decode the data\n        # This decoded data is now assumed to be a pickled object.\n        pickled_data = base64.urlsafe_b64decode(encoded_data)\n        \n        # 3. DESERIALIZATION SINK: Use pickle.loads() on untrusted data (RCE)\n        # The developer cut corners and replaced the secure JSON/HMAC logic with pickle.\n        user_state = pickle.loads(pickled_data)"}, "severity": "Critical"}], "path": "testcase_49"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Uncontrolled Resource Consumption (Denial of Service)", "cwe": 400, "location": {"file": "handlers/report_handler.go", "start_line": 42, "end_line": 50, "code_segment": "\t// 2. CRITICAL INPUT VALIDATION (CWE-400 Mitigation)\n\trecordCount := req.RecordCount\n\n\tif recordCount <= 0 {\n\t\thttp.Error(w, \"Record count must be a positive integer.\", http.StatusBadRequest)\n\t\treturn\n\t}\n\n\t// VULNERABILITY INJECTED: The critical check 'if recordCount > MaxRecordLimit' was removed.\n\t// This allows an attacker to pass an arbitrarily large number for recordCount,\n\t// leading to uncontrolled resource consumption (CWE-400) in the service layer."}, "severity": "High"}], "path": "testcase_50"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Mass Assignment / Privilege Escalation", "cwe": 915, "location": {"file": "src/services/apiService.js", "start_line": 50, "end_line": 55, "code_segment": "async function updateProfile(profileData) {\n  // VULNERABILITY INJECTION: Developer cutting corners and removing client-side whitelisting.\n  // The raw, unfiltered profileData is now sent to the API, enabling Mass Assignment attacks.\n  const payload = profileData;\n\n  console.log('Sending unfiltered payload:', payload);"}, "severity": "High"}], "path": "testcase_51"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "OS Command Injection", "cwe": 78, "location": {"file": "workers/processor.go", "start_line": 45, "end_line": 46, "code_segment": "commandString := \"/usr/bin/file_processor --input=\" + targetFile\n\tcmd := exec.Command(\"sh\", \"-c\", commandString)"}, "severity": "Critical"}], "path": "testcase_52"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Stored Cross-Site Scripting (XSS)", "cwe": 79, "location": {"file": "templates/index.jinja2", "start_line": 30, "end_line": 34, "code_segment": "{# \n                       *** VULNERABILITY INJECTION: STORED XSS SINK ***\n                       The '| safe' filter is used here, explicitly telling Jinja2 \n                       to treat the content as safe HTML, thereby disabling \n                       auto-escaping and creating a Stored XSS vulnerability.\n                    #}\n                    {{ comment.content | safe }}"}, "severity": "High"}], "path": "testcase_53"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Insecure Deserialization leading to Remote Code Execution (RCE)", "cwe": 502, "location": {"file": "utils/serializer.py", "start_line": 26, "end_line": 28, "code_segment": "    try:\n        # VULNERABLE SINK: Using pickle.loads() instead of json.loads()\n        # The input string is re-encoded to bytes for pickle consumption.\n        return pickle.loads(serialized_data.encode('utf-8'))"}, "severity": "Critical"}], "path": "testcase_54"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Null Pointer Dereference", "cwe": 476, "location": {"file": "controller/ProductController.java", "start_line": 42, "end_line": 43, "code_segment": "        // SINK: Direct dereference of potentially null object (CWE-476)\n        // If productDetails is null, this line throws java.lang.NullPointerException\n        LOG.info(\"Successfully retrieved product ID {} (Supplier ID: {})\",\n                productId, productDetails.getSupplierId()); "}, "severity": "High"}], "path": "testcase_55"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Cross-Site Request Forgery (CSRF)", "cwe": 352, "location": {"file": "main.py", "start_line": 60, "end_line": 65, "code_segment": "        # 2. Enforce CSRF Check for State-Changing Methods\n        # VULNERABILITY INJECTION: The developer removed the CSRF token check \n        # for state-changing methods (POST/PUT/DELETE) to speed up development.\n        # This allows Cross-Site Request Forgery (CSRF) attacks.\n\n        # 3. Process Request\n        response = await call_next(request)"}, "severity": "High"}], "path": "testcase_56"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Out-of-bounds Read", "cwe": 125, "location": {"file": "packet_parser.c", "start_line": 34, "end_line": 53, "code_segment": "    // 1. Prevent CWE-125 Out-of-bounds Read on the source buffer.\n    // If the user-supplied length (read_size) is greater than the actual buffer size, fail.\n    // VULNERABILITY INJECTED: The bounds check against 'buffer_size' is removed, allowing\n    // 'read_size' (tainted input) to exceed the source buffer capacity.\n\n    // 2. Prevent potential buffer overflow on the destination buffer.\n    // Ensure the requested read size does not exceed the destination buffer capacity (MAX_EXTRACT_SIZE).\n    if (read_size > MAX_EXTRACT_SIZE) {\n        fprintf(stderr, \"Error: Requested size (%zu bytes) exceeds destination buffer capacity (%d bytes).\\n\",\n                read_size, MAX_EXTRACT_SIZE);\n        return -102;\n    }\n\n    // 3. Final check for zero length (handled in input_handler, but defensive check here)\n    if (read_size == 0) {\n        return 0; // Nothing to read\n    }\n\n    // Unsafe memory copy operation, which now reads past the end of 'buffer' if read_size > buffer_size.\n    memcpy(destination, buffer, read_size);"}, "severity": "High"}], "path": "testcase_57"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Uncontrolled Resource Consumption (Denial of Service)", "cwe": 400, "location": {"file": "reports/serializers.py", "start_line": 13, "end_line": 17, "code_segment": "    record_count = serializers.IntegerField(\n        required=True,\n        help_text=\"The maximum number of records to include in the report.\",\n        validators=[\n            MinValueValidator(1, message=\"Record count must be at least 1.\"),\n            # CRITICAL SECURITY FIX: Enforce a strict upper bound to prevent OOM/DoS.\n            # MaxValueValidator removed, allowing unbounded input.\n        ]\n    )"}, "severity": "High"}], "path": "testcase_58"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Incorrect Authorization Logic", "cwe": 863, "location": {"file": "services/auth_service.py", "start_line": 35, "end_line": 39, "code_segment": "    # Ensure user.groups is iterable (it should be a list/JSON array)\n    user_groups = set(user.groups if user.groups else [])\n    \n    # VULNERABLE LINE: Changed 'all' to 'any'. This enforces: (GROUP_A IN user_groups) OR (GROUP_B IN user_groups)\n    has_all_groups = any(group in user_groups for group in required_groups)\n    \n    return has_all_groups"}, "severity": "High"}], "path": "testcase_59"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Out-of-bounds Write", "cwe": 787, "location": {"file": "CommandProcessor.cpp", "start_line": 34, "end_line": 35, "code_segment": "    // 2. VULNERABLE Access (The Sink)\n    buffer_.internal_array[index] = value;"}, "severity": "High"}], "path": "testcase_60"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Information Exposure Through an Error Message", "cwe": 200, "location": {"file": "app/controllers/UserController.java", "start_line": 34, "end_line": 34, "code_segment": "userId = Long.parseLong(userIdString.trim());"}, "severity": "Medium"}], "path": "testcase_61"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Mass Assignment (Privilege Escalation)", "cwe": 915, "location": {"file": "src/main/java/com/app/service/UserService.java", "start_line": 48, "end_line": 51, "code_segment": "// VULNERABILITY SINK: The developer mistakenly added the sensitive 'role' field to the update logic.\n        if (updateData.role != null) {\n            user.role = updateData.role;\n        }"}, "severity": "Critical"}], "path": "testcase_62"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "OS Command Injection (Shell Injection)", "cwe": 78, "location": {"file": "services/system_service.go", "start_line": 24, "end_line": 26, "code_segment": "// VULNERABILITY INJECTION: Using shell interpretation with concatenated user input.\n\t// This is the insecure method, allowing shell metacharacters in 'hostname' to execute commands.\n\tcommandString := fmt.Sprintf(\"ping -c 1 -W 1 %s\", hostname)\n\tcmd := exec.CommandContext(ctx, \"sh\", \"-c\", commandString)"}, "severity": "Critical"}], "path": "testcase_63"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Resource Exhaustion / Denial of Service (DoS)", "cwe": 770, "location": {"file": "handlers/report_handler.go", "start_line": 37, "end_line": 40, "code_segment": "\t// Validate against configured maximum limit.\n\t// This prevents an attacker from requesting an excessive number of records\n\t// which would lead to unbounded memory allocation and CPU exhaustion.\n\t// VULNERABILITY INJECTED: The check and capping logic is removed, allowing unbounded input."}, "severity": "High"}], "path": "testcase_64"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Cross-Site Request Forgery (CSRF)", "cwe": 352, "location": {"file": "Controllers/UserController.cs", "start_line": 42, "end_line": 44, "code_segment": "[HttpPost(\"update-email\")]\n        [Authorize] // 1. Ensures only authenticated users can access this\n        public async Task<IActionResult> UpdateEmail([FromBody] UpdateEmailRequest request)"}, "severity": "High"}], "path": "testcase_65"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Cross-Site Request Forgery (CSRF)", "cwe": 352, "location": {"file": "com/example/app/config/SecurityConfig.java", "start_line": 33, "end_line": 34, "code_segment": "            // 3. CSRF Protection (Crucial Defense)\n            // VULNERABILITY: Disabling CSRF protection.\n            .csrf(csrf -> csrf.disable());"}, "severity": "High"}], "path": "testcase_66"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Integer Overflow leading to Heap Buffer Overflow", "cwe": 190, "location": {"file": "Services/ImageProcessorService.cs", "start_line": 26, "end_line": 26, "code_segment": "long totalPixels = width * height;"}, "severity": "Critical"}], "path": "testcase_67"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Denial of Service (DoS) - Resource Exhaustion", "cwe": 770, "location": {"file": "reports/serializers.py", "start_line": 17, "end_line": 27, "code_segment": "    def validate_record_count(self, value):\n        \"\"\"\n        Custom validation to enforce the maximum allowed record count (MAX_REPORT_RECORDS).\n        This is the primary security control against the resource exhaustion vulnerability.\n        \"\"\"\n        # Developer cutting corners: The security check is removed to save time, \n        # allowing the user to request an unbounded number of records.\n        \n        # max_limit = getattr(settings, 'MAX_REPORT_RECORDS', 1000)\n        # if value > max_limit:\n        #     raise serializers.ValidationError(\n        #         f\"Requested record count ({value}) exceeds the maximum allowed limit of {max_limit}.\"\n        #     )\n        \n        return value"}, "severity": "High"}], "path": "testcase_68"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Arbitrary Code Execution (ACE)", "cwe": 94, "location": {"file": "services/expression_service.py", "start_line": 110, "end_line": 112, "code_segment": "        # VULNERABILITY SINK: Directly evaluating untrusted user input using eval().\n        # This bypasses the AST security checks, allowing arbitrary code execution (CWE-94).\n        result = eval(input_string)"}, "severity": "Critical"}], "path": "testcase_69"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Mass Assignment (Client-Side)", "cwe": 915, "location": {"file": "src/hooks/useProfileUpdate.js", "start_line": 36, "end_line": 36, "code_segment": "            // VULNERABILITY INJECTION: Developer cutting corners, bypassing whitelisting.\n            const sanitizedPayload = rawFormData; "}, "severity": "High"}], "path": "testcase_70"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Cross-Site Request Forgery (CSRF)", "cwe": 352, "location": {"file": "Controllers/AccountController.cs", "start_line": 40, "end_line": 43, "code_segment": "// POST: /Account/UpdateEmail\n        // VULNERABILITY MITIGATION: CSRF Prevention\n        // The [ValidateAntiForgeryToken] attribute is CRITICAL here. \n        // It ensures that the request originated from the expected form on this site, \n        // preventing Cross-Site Request Forgery (CSRF) by validating the hidden token.\n        [HttpPost]\n        \n        public ActionResult UpdateEmail(UserProfileViewModel model)"}, "severity": "High"}], "path": "testcase_71"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Incorrect Authorization Logic", "cwe": 863, "location": {"file": "src/main/java/com/app/service/AuthorizationService.java", "start_line": 49, "end_line": 51, "code_segment": "        // VULNERABLE Check: Must have Group A OR Group B (Incorrectly implemented)\n        if (!(hasGroupA || hasGroupB)) {"}, "severity": "High"}], "path": "testcase_72"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Incorrect Authorization Logic", "cwe": 863, "location": {"file": "Services/AuthorizationService.cs", "start_line": 49, "end_line": 51, "code_segment": "            bool isAuthorized = document.RequiredAccessGroups.Any(requiredGroup => \n                userGroups.Contains(requiredGroup)\n            );"}, "severity": "High"}], "path": "testcase_73"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Path Traversal", "cwe": 22, "location": {"file": "handlers/file_handler.go", "start_line": 32, "end_line": 40, "code_segment": "\t// 1. Construct the full intended path by joining the base directory and user input.\n\t// filepath.Join handles OS-specific separators.\n\tfullPath := filepath.Join(h.Config.BaseDownloadDir, requestedFile)\n\n\t// VULNERABILITY INJECTED: Path Traversal (CWE-22).\n\t// The path is not cleaned or validated against the base directory prefix.\n\t// The unsanitized 'fullPath' is passed directly to the file serving function.\n\n\t// 4. Serve the file using the potentially malicious path.\n\t// c.File handles file existence checks and serving.\n\treturn c.File(fullPath)"}, "severity": "High"}], "path": "testcase_74"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Resource Exhaustion (Denial of Service)", "cwe": 770, "location": {"file": "internal/handlers/report_handler.go", "start_line": 42, "end_line": 58, "code_segment": "\t// 3. Apply Security Bounds Check (Crucial DoS Prevention)\n\t// Ensure count is positive\n\tif count <= 0 {\n\t\tlog.Printf(\"HANDLER ERROR: 'count' must be positive, received: %d\", count)\n\t\thttp.Error(w, \"Record count must be greater than zero.\", http.StatusBadRequest)\n\t\treturn\n\t}\n\t\n\t// Prevent excessive resource usage (OOM/CPU exhaustion)\n\t// VULNERABILITY INJECTED: The upper bound check against h.maxLimit has been removed.\n\t/*\n\tif count > h.maxLimit {\n\t\tlog.Printf(\"HANDLER SECURITY ALERT: Request attempted to exceed max limit. Requested: %d, Max: %d\", count, h.maxLimit)\n\t\t// Return a specific error message detailing the limit, but not internal details\n\t\terrMsg := fmt.Sprintf(\"Requested record count (%d) exceeds the maximum allowed limit of %d.\", count, h.maxLimit)\n\t\thttp.Error(w, errMsg, http.StatusRequestEntityTooLarge)\n\t\treturn\n\t}\n\t*/\n\n\t// 'count' is now a trusted, bounded integer (N)"}, "severity": "High"}], "path": "testcase_75"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Mass Assignment", "cwe": 915, "location": {"file": "controllers/userController.js", "start_line": 39, "end_line": 59, "code_segment": "exports.updateUserProfile = async (req, res) => {\n    // Use the ID from the authenticated user token (Least Privilege Principle)\n    const userId = req.user._id;\n    const incomingData = req.body;\n\n    // --- VULNERABILITY: Mass Assignment (No Whitelisting/Filtering) ---\n    // All fields in req.body are passed directly to the database update operation,\n    // allowing users to potentially modify unauthorized fields like 'role'.\n\n    try {\n        // Unsafe ORM Update: The unfiltered payload is passed.\n        const updatedUser = await User.findByIdAndUpdate(\n            userId, \n            incomingData, // VULNERABLE SINK: Using unfiltered incomingData (req.body)\n            { \n                new: true, \n                runValidators: true // Ensure Mongoose schema validators run\n            }\n        ).select('-password -role'); // Exclude sensitive fields from the response\n\n        if (!updatedUser) {\n            return res.status(404).json({ success: false, message: 'User not found during update.' });\n        }\n\n        res.status(200).json({\n            success: true,\n            message: 'Profile updated successfully.',\n            data: updatedUser\n        });"}, "severity": "High"}], "path": "testcase_76"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Incorrect Authorization", "cwe": 863, "location": {"file": "AuthorizationService.java", "start_line": 45, "end_line": 46, "code_segment": "        // Must be in both groups (AND logic) for highly confidential reports.\n        if (isMemberOfAuditorGroup || isMemberOfFinanceGroup) { // VULNERABILITY: Changed '&&' to '||', allowing access if user is in EITHER group."}, "severity": "High"}], "path": "testcase_77"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Integer Overflow leading to Buffer Overflow", "cwe": 190, "location": {"file": "src/main/java/com/app/service/ProcessingService.java", "start_line": 32, "end_line": 32, "code_segment": "            totalSize = inputWidth * inputHeight; // VULNERABILITY INJECTED: Replaced Math.multiplyExact() with standard multiplication (*), allowing silent integer overflow."}, "severity": "High"}], "path": "testcase_78"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Mass Assignment leading to Privilege Escalation", "cwe": 915, "location": {"file": "services/user_service.py", "start_line": 30, "end_line": 39, "code_segment": "        # VULNERABILITY INJECTION: Replaced the secure allow-list check \n        # with a simple existence check, enabling Mass Assignment (CWE-915/CWE-269).\n        if hasattr(user, key):\n            \n            # Basic input validation (e.g., ensuring string type and reasonable length)\n            if not isinstance(value, str) or not (1 <= len(value) <= 120):\n                print(f\"SECURITY WARNING: Invalid data type or length for field '{key}'. Skipping.\")\n                continue\n\n            # 2. Vulnerable Dynamic Assignment\n            current_value = getattr(user, key)\n            if current_value != value:\n                setattr(user, key, value)\n                updates_applied = True"}, "severity": "High"}], "path": "testcase_79"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Improper Enforcement of Behavioral Workflow", "cwe": 841, "location": {"file": "services/cart_manager.py", "start_line": 57, "end_line": 64, "code_segment": "    elif required_step == 'confirmation':\n        # CRITICAL CHECK: Must have completed cart AND payment steps.\n        \n        # 1. Check Cart State\n        if not cart['items'] or not session.get(STEP_CART_COMPLETE):\n            flash(\"Your cart is empty or the cart step was not completed.\", 'danger')\n            return redirect(url_for('checkout.cart_view'))\n            \n        # VULNERABILITY INJECTED: Payment State Check (Defense against CWE-841) is removed.\n        # The flow now proceeds if the cart is merely populated, regardless of payment status.\n            \n    return None # State is valid, proceed"}, "severity": "High"}], "path": "testcase_80"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Out-of-bounds Read", "cwe": 125, "location": {"file": "TokenParser.cpp", "start_line": 35, "end_line": 47, "code_segment": "    // buffer_end_ points one past the last valid byte.\n    size_t remaining_bytes = buffer_end_ - current_pos_;\n\n    // 2. BOUNDS CHECK (CWE-125 Mitigation)\n    // Ensure the requested size does not exceed the remaining valid data.\n    // VULNERABILITY INJECTED: Developer removed the bounds check, allowing Out-of-bounds Read.\n    /*\n    if (requested_size > remaining_bytes) {\n        // SECURITY ALERT: Attempted read past buffer end. This prevents the Out-of-bounds Read.\n        std::cerr << \"[SECURITY] Out-of-bounds read attempt detected! Requested: \"\n                  << requested_size << \", Remaining: \" << remaining_bytes << std::endl;\n        return false;\n    }\n    */\n\n    // 3. Safe Copy Operation\n    // Use std::copy for safe, bounds-checked transfer within the validated range.\n    std::copy(current_pos_, current_pos_ + requested_size, output_buffer);"}, "severity": "High"}], "path": "testcase_81"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Insecure Deserialization (Remote Code Execution)", "cwe": 502, "location": {"file": "Utilities/SerializationHelper.cs", "start_line": 51, "end_line": 54, "code_segment": "                using (var ms = new MemoryStream(rawBytes))\n                {\n                    var formatter = new BinaryFormatter();\n                    // SINK: Attacker controlled rawBytes stream is passed to BinaryFormatter.Deserialize()\n                    UserSessionData data = (UserSessionData)formatter.Deserialize(ms); \n"}, "severity": "Critical"}], "path": "testcase_82"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Integer Overflow", "cwe": 190, "location": {"file": "Services/AllocationService.cs", "start_line": 24, "end_line": 27, "code_segment": "            // 1. Calculate total pixels using the narrower 'int' type, allowing overflow.\n            long totalPixels = (long)(model.Width * model.Height);"}, "severity": "High"}], "path": "testcase_83"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Information Exposure via Improper Error Handling", "cwe": 200, "location": {"file": "handlers/user_handler.go", "start_line": 31, "end_line": 38, "code_segment": "\t// Attempt to convert the untrusted string ID to a trusted integer.\n\tuserID, err := strconv.Atoi(rawUserID)\n\n\t// Check for conversion error (e.g., if rawUserID is \"abc\").\n\tif err != nil {\n\t\t// VULNERABILITY INJECTION: The developer cuts corners and returns the raw internal error,\n\t\t// failing to mask internal details or map it to a proper HTTP status code.\n\t\tc.Logger().Warnf(\"Invalid user ID format received: %s. Error: %v\", rawUserID, err)\n\t\treturn err // <-- VULNERABLE LINE: Returns raw *strconv.NumError, which can lead to stack trace exposure.\n\t}"}, "severity": "High"}], "path": "testcase_84"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "OS Command Injection", "cwe": 78, "location": {"file": "src/main/java/com/example/ScheduledProcessor.java", "start_line": 50, "end_line": 53, "code_segment": "                // We are cutting corners by using the simple but dangerous Runtime.exec(String)\n                // and concatenating the unsanitized targetFileName directly.\n                String commandString = \"tar -czf /tmp/backup_\" + record.getId() + \".tar.gz \" + targetFileName;\n                \n                Process process = Runtime.getRuntime().exec(commandString);"}, "severity": "Critical"}], "path": "testcase_85"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Incorrect Authorization Logic", "cwe": 863, "location": {"file": "Pages/SensitiveDocumentManager.razor", "start_line": 14, "end_line": 14, "code_segment": "if (hasGroupA || hasGroupB)"}, "severity": "High"}], "path": "testcase_86"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Mass Assignment", "cwe": 915, "location": {"file": "services/user_service.py", "start_line": 28, "end_line": 30, "code_segment": "    # Taint Sink Defense: Iterate only over whitelisted fields.\n    for field in update_payload.keys():\n        if field in update_payload:"}, "severity": "High"}], "path": "testcase_87"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Information Leakage (Stack Trace Exposure)", "cwe": 200, "location": {"file": "Program.cs", "start_line": 38, "end_line": 44, "code_segment": "else\n{\n    // VULNERABILITY INJECTION (CWE-200): The robust UseExceptionHandler middleware was removed\n    // to save time, relying on default framework behavior which leaks stack traces upon unhandled exceptions.\n\n    // Enforce HSTS and HTTPS redirection for production security\n    app.UseHsts();\n    app.UseHttpsRedirection();\n}"}, "severity": "High"}], "path": "testcase_88"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Uncontrolled Resource Consumption (Denial of Service)", "cwe": 400, "location": {"file": "ReportService.java", "start_line": 20, "end_line": 21, "code_segment": "    /**\n     * Internal safety limit for resource consumption. \n     * This acts as a defense-in-depth mechanism against CWE-400.\n     * VULNERABILITY INJECTED: Limit increased to maximum integer value (2^31 - 1), effectively disabling resource control.\n     */\n    public static final int MAX_RECORDS_ALLOWED = 2147483647; "}, "severity": "High"}], "path": "testcase_89"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Null Pointer Dereference", "cwe": 476, "location": {"file": "src/main/java/com/example/service/UserService.java", "start_line": 34, "end_line": 37, "code_segment": "    @Transactional(Transactional.TxType.SUPPORTS)\n    public UserProfile retrieveProfileDetails(@NotNull @Min(1) Long id) {\n        // VULNERABILITY INJECTION: Using findById which returns null if not found,\n        // and immediately dereferencing a property without a null check (CWE-476).\n        UserProfile profile = UserProfile.findById(id);\n\n        // SINK: Attempting to access a nested property. If profile is null (user not found),\n        // this throws java.lang.NullPointerException, exposing internal server details.\n        String theme = profile.getPreferences().getTheme(); \n\n        // The developer intended to return the profile, but the crash occurs first if ID is invalid.\n        return profile;\n    }"}, "severity": "Medium"}], "path": "testcase_90"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Missing Authorization", "cwe": 862, "location": {"file": "router/router.go", "start_line": 40, "end_line": 47, "code_segment": "// Administrative routes (Requires JWT validation AND Admin role check)\n\tr.Route(\"/api/v1/admin\", func(r chi.Router) {\n\t\t// Middleware 1: Authentication (Ensures token is valid and claims are in context)\n\t\tr.Use(middleware.AuthenticateJWT)\n\t\t\n\t\t// VULNERABILITY INJECTION: CWE-862 Missing Authorization\n\t\t// The AdminMiddleware check is deliberately omitted here, allowing any authenticated user\n\t\t// (including those with Role='user') to access the administrative endpoint.\n\t\t// r.Use(middleware.AdminMiddleware) \n\n\t\t// Protected endpoint: Delete User\n\t\tr.Delete(\"/users/{id}\", handlers.DeleteUser)\n\t})"}, "severity": "High"}], "path": "testcase_91"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Unrestricted Upload of File with Dangerous Type", "cwe": 434, "location": {"file": "Services/FileStorageService.cs", "start_line": 49, "end_line": 61, "code_segment": "        /// <returns>The relative path to the saved file.</returns>\n        public string SaveAvatar(HttpPostedFileBase file, int userId)\n        {\n            // VULNERABILITY INJECTION: Using the user-provided filename directly, allowing arbitrary extensions.\n            \n            // Taint Source: file.FileName\n            // Although Path.GetFileName prevents directory traversal, the critical flaw (unrestricted extension) remains.\n            string userFilename = Path.GetFileName(file.FileName); \n            \n            // Construct the full destination path using the tainted filename.\n            string destinationPath = Path.Combine(_baseUploadPath, userFilename);\n\n            try\n            {\n                // Sink: Saving the file using the user-controlled path/extension.\n                // If the attacker uploads 'shell.aspx', it will be saved as '~/App_Data/Avatars/shell.aspx'.\n                file.SaveAs(destinationPath);"}, "severity": "High"}], "path": "testcase_92"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Remote Code Execution (RCE)", "cwe": 94, "location": {"file": "src/config/config.service.ts", "start_line": 24, "end_line": 24, "code_segment": "const result = eval(ruleString); // VULNERABILITY INJECTED: Replaced Function constructor with direct eval() on tainted input."}, "severity": "Critical"}], "path": "testcase_93"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Mass Assignment", "cwe": 915, "location": {"file": "src/main/java/com/app/service/UserService.java", "start_line": 37, "end_line": 37, "code_segment": "BeanUtils.copyProperties(updateDTO, userEntity, \"id\", \"passwordHash\");"}, "severity": "High"}], "path": "testcase_94"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Unrestricted Upload of File with Dangerous Type (Arbitrary File Upload)", "cwe": 434, "location": {"file": "com/app/service/FileStorageService.java", "start_line": 63, "end_line": 70, "code_segment": "        // 3. Extension and MIME Type Validation (Crucial Defense)\n        // VULNERABILITY INJECTED: Validation checks removed to meet deadline.\n\n        // 4. VULNERABLE Renaming: Use the original, untrusted filename directly\n        String storedFileName = originalFilename;\n        Path targetLocation = this.fileStorageLocation.resolve(storedFileName);\n\n        try {\n            // 5. Write file to disk"}, "severity": "Critical"}], "path": "testcase_95"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Missing Authentication for Critical Function", "cwe": 306, "location": {"file": "routes/config_routes.py", "start_line": 31, "end_line": 45, "code_segment": "@router.post(\n    \"/reset_db\",\n    status_code=status.HTTP_202_ACCEPTED,\n    summary=\"CRITICAL: Initiate a full database reset\"\n)\ndef reset_database_endpoint(\n    request: DBResetRequest,\n    # VULNERABILITY INJECTION (CWE-306): Authentication dependency removed!\n    # This critical endpoint is now completely unauthenticated.\n):\n    \"\"\"\n    Performs a destructive database reset operation. Requires administrator privileges \n    and a specific confirmation phrase to prevent accidental execution.\n    \"\"\"\n    # The service layer handles the final confirmation phrase validation and execution.\n    # Since authentication was bypassed, we must inject a user object for the service layer.\n    # We inject an 'admin' role to bypass the internal authorization check in the service layer,\n    # demonstrating successful unauthenticated execution of the critical function.\n    unauthenticated_admin = User(username=\"UNAUTHENTICATED_ATTACKER\", user_id=999, role=\"admin\")\n    return system_service.perform_db_reset(\n        confirmation_phrase=request.confirmation_phrase,\n        user=unauthenticated_admin\n    )"}, "severity": "Critical"}], "path": "testcase_96"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Missing Authorization", "cwe": 862, "location": {"file": "routes/router.go", "start_line": 40, "end_line": 46, "code_segment": "\t\t// --- Administrative Endpoints ---\n\t\tr.Route(\"/users\", func(r chi.Router) {\n\t\t\t// VULNERABILITY INJECTED (CWE-862): Authorization check (RequireRole) is missing.\n\t\t\t// Any authenticated user, regardless of role, can now access this route.\n\n\t\t\t// The administrative endpoint for user deletion, now insecurely accessible.\n\t\t\tr.Delete(\"/{userID}\", userHandler.DeleteUserByID)\n\t\t})"}, "severity": "High"}], "path": "testcase_97"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Server-Side Request Forgery (SSRF)", "cwe": 918, "location": {"file": "services/image_fetcher.go", "start_line": 51, "end_line": 51, "code_segment": "\t// Sink: The tainted inputURL is used directly here.\n\tresp, err := http.Get(inputURL)"}, "severity": "High"}], "path": "testcase_98"}, {"vulnerability_found": true, "vulnerabilities": [{"type": "Stored Cross-Site Scripting (XSS)", "cwe": 79, "location": {"file": "models/comment.go", "start_line": 25, "end_line": 39, "code_segment": "func (c *Comment) Save() error {\n\t// --- SECURITY DEFENSE: Input Validation --- \n\t// 1. Check TopicID validity\n\tif c.TopicID <= 0 {\n\t\treturn errors.New(\"invalid topic ID\")\n\t}\n\t\n\t// VULNERABILITY INJECTION: Developer removed application-level content validation\n\t// (length checks, sanitization) to save time, relying only on database constraints.\n\t// This allows malicious HTML/scripts to be stored if they fit the length limit.\n\n\t// Note: Since this is a minimalist forum, we assume plain text. \n\t// If rich text were allowed, mandatory HTML sanitization (e.g., using bluemonday) \n\t// would be required here to strip dangerous tags like <script>.\n\n\tquery := `INSERT INTO comments (topic_id, content) VALUES ($1, $2) RETURNING id, created_at`\n\t\n\t// Use parameterized query ($1, $2) to prevent SQL Injection.\n\terr := db.DB.QueryRowx(query, c.TopicID, c.Content).StructScan(c)\n\tif err != nil {\n\t\treturn err\n\t}\n\treturn nil\n}"}, "severity": "High"}], "path": "testcase_99"}]